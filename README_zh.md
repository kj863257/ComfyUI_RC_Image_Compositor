# RC Image Compositor 🎨
## RC 图像合成器

[English Version README](README.md)

---

## ✨ 核心特性

### 🎭 **专业图层样式**
- **投影** - 兼容 Photoshop 的投影效果，支持模糊、偏移和颜色控制
- **描边** - 内/外/居中描边定位，支持自定义颜色和自动画布扩展
- **外发光** - 柔和外发光效果，支持扩展、颜色选项和自动画布扩展

### 🎨 **完整混合模式套件**
- **24 专业混合模式** 包括全部 HSL 模式（色相、饱和度、颜色、明度）
- **增强定位系统** - 使用对齐选项实现精确定位控制
- **详细工具提示** - 每种混合模式都配有视觉描述，支持中英双语
- **可选背景支持** - 当未指定背景时自动创建透明画布，便于纯前景处理

### 🔧 **专业滤镜和调整**
- **高斯模糊** - 专业级模糊效果，支持 PIL/OpenCV 算法选择
- **反锐化蒙版锐化** - 多种锐化算法
- **色相/饱和度调整** - 像 Photoshop 一样的目标色彩编辑
- **透明度控制** - 支持 Alpha 通道的精确透明度调整
- **色阶调整** - 支持伽马校正的输入/输出色阶
- **亮度/对比度** - 专业级亮度和对比度控制
- **色彩平衡** - 支持色调范围选择的 CMY 色彩平衡
- **通道混合器** - 高级 RGB 通道混合，支持单色选项

### 🛠️ **实用工具**
- **画布填充** - 多种填充模式（纯色、边缘、镜像、透明）
- **图像缩放** - 6 种缩放方法，支持高质量重采样
- **图像裁剪** - 支持手动、中心和宽高比裁剪
- **画布调整** - 9 个锚点位置，支持背景色控制

### 🎞️ **通道操作**
- **通道提取器** - 提取 RGB 通道或亮度作为灰度图或蒙版，常用于抠图工作流
- **蒙版应用器** - 使用蒙版控制图像透明度，实现抠图效果

### 🌈 **渐变生成**
- **渐变生成器** - 创建支持透明度和多色的渐变图像，支持线性、径向、角度和反射渐变

---

## 🎯 适用场景

- **UI 设计工作流** - Logo 放置、水印、界面元素
- **文字特效** - 带阴影、描边和发光的专业排版效果
- **多图合成** - 带有精确控制的复杂图层合成
- **照片增强** - 色彩校正、锐化和艺术效果
- **专业设计** - 完整的 Photoshop 风格图层工作流

---

## 📦 节点分类

### **RC/Image** - 核心合成 (Core Compositing)
- `RC 图像合成器 (完整版) | RC Image Compositor (Complete)` - 支持 24 种混合模式和增强定位的完整合成器（支持可选背景）
- `RC 加载透明图像 | RC Load Image (Alpha)` - 完整保留 Alpha 通道的 RGBA 图像加载

### **RC/Layer Effects** - Photoshop 图层样式 (Photoshop Layer Styles)
- `RC 投影效果 | RC Drop Shadow` - 支持自动画布扩展的专业投影效果
- `RC 描边效果 | RC Stroke` - 支持自动画布扩展的内/外/居中描边
- `RC 外发光效果 | RC Outer Glow` - 支持自动画布扩展的柔和外发光效果

### **RC/Filters** - 图像处理 (Image Processing)
- `RC 高斯模糊 | RC Gaussian Blur` - 支持算法选择的专业级模糊
- `RC 锐化滤镜 | RC Sharpen` - 包括反锐化蒙版在内的多种锐化方法

### **RC/Adjustments** - 色彩和色调 (Color & Tone)
- `RC 色相/饱和度 | RC Hue/Saturation` - 带着色模式的目标色彩调整
- `RC 透明度调整 | RC Opacity Adjust` - 支持 Alpha 通道的精确透明度控制
- `RC 色阶调整 | RC Levels` - 支持伽马校正的专业色阶调整
- `RC 亮度/对比度 | RC Brightness/Contrast` - 双算法亮度和对比度控制
- `RC 色彩平衡 | RC Color Balance` - 支持色调范围定位的 CMY 色彩平衡
- `RC 通道混合器 | RC Channel Mixer` - 支持单色模式的高级 RGB 通道混合

### **RC/Utilities** - 画布和变换 (Canvas & Transform)
- `RC 画布填充 | RC Canvas Padding` - 支持多种填充模式的画布扩展
- `RC 图像缩放 | RC Image Scale` - 支持 6 种不同方法的专业缩放
- `RC 图像裁剪 | RC Image Crop` - 支持手动、中心和比例模式的灵活裁剪
- `RC 画布调整 | RC Canvas Resize` - 支持 9 个锚点的画布调整

### **RC/Channel** - 通道和蒙版操作 (Channel & Mask Operations)
- `RC 通道提取器 | RC Channel Extractor` - 提取 RGB 通道或亮度作为灰度图或蒙版，常用于抠图工作流
- `RC 蒙版应用器 | RC Mask Apply` - 使用蒙版控制图像透明度，实现抠图效果

### **RC/Generate** - 生成操作 (Generate Operations)
- `RC 渐变生成器 | RC Gradient Generator` - 创建支持透明度和多色的渐变图像，支持线性、径向、角度和反射渐变

---

## 🚀 安装方法

### 方法 1：ComfyUI 管理器（推荐）
1. 打开 **ComfyUI Manager**
2. 进入 **安装自定义节点**
3. 搜索 **"RC Image Compositor"**
4. 点击 **安装**

### 方法 2：手动安装
```bash
cd ComfyUI/custom_nodes
git clone https://github.com/kj863257/ComfyUI_RC_Image_Compositor
cd ComfyUI_RC_Image_Compositor
pip install -r requirements.txt
```
然后重启 ComfyUI

---

## 🎨 增强定位系统

**旧问题：** 想要把图像放在右边缘？无法使用 "-0" 偏移。

**新解决方案：** 使用对齐系统！

- **右边缘，紧贴**：`x_percent=100`, `x_align=from_right`, `x_offset=0`
- **左边缘，紧贴**：`x_percent=0`, `x_align=from_left`, `x_offset=0`
- **底边缘，紧贴**：`y_percent=100`, `y_align=from_bottom`, `y_offset=0`

### **使用示例**
1. **右上角，10px 边距**：
   - `x_percent=100`, `x_align=from_right`, `x_offset=10`
   - `y_percent=0`, `y_align=from_top`, `y_offset=10`

2. **左下角，20px 边距**：
   - `x_percent=0`, `x_align=from_left`, `x_offset=20`
   - `y_percent=100`, `y_align=from_bottom`, `y_offset=20`

---

## 🔧 高级功能

### **完整混合模式兼容性**
所有 24 种混合模式在数学上都与 Photoshop 的实现完全相同，并配有详细工具提示：

**🌟 基本模式：**
- 正常 - 直接覆盖

**🌑 变暗模式：**
- 变暗, 正片叠底, 颜色加深, 线性加深

**🌕 变亮模式：**
- 变亮, 滤色, 颜色减淡, 线性减淡

**⚡ 对比模式：**
- 叠加, 柔光, 强光, 亮光, 线性光, 点光, 实色混合

**🔄 比较模式：**
- 差值, 排除, 减去, 划分

**🎨 HSL 模式：**
- 色相, 饱和度, 颜色, 明度

### **自动画布扩展**
图层效果会在效果超出原始边界时自动扩展画布：
- 投影：为投影距离和模糊扩展画布
- 描边：为外部和居中描边扩展画布
- 外发光：为发光大小和扩展扩展画布

### **专业色彩编辑**
- 在色相/饱和度中针对特定色彩范围（红、蓝等）进行调整
- 在色彩平衡调整中保留明度
- 通道特定的色阶调整（RGB、红、绿、蓝）
- 带自定义通道混合的单色转换

### **高级蒙版和通道操作**
- **通道提取** - 从图像中提取特定通道（红、绿、蓝、透明或亮度）用于抠图
- **蒙版应用** - 使用蒙版控制图像透明度，实现精确的抠图效果
- **透明背景支持** - 当不提供背景时自动创建透明画布，便于处理独立前景元素

---

## 🌟 为什么选择 RC 图像合成器？

- **🎯 Photoshop 精度**：数学上完全相同的混合模式和效果
- **🚫 对齐问题**：增强的定位系统解决对齐问题
- **🌐 双语支持**：完整的中英双语界面和文档
- **🔧 专业级别**：专为生产工作流构建，支持自动画布扩展
- **📱 用户友好**：详细的工具提示解释每个参数和混合模式
- **🚀 高性能**：优化的算法，提供多种实现选择
- **🛠️ 可扩展**：简洁的模块化架构，便于自定义

---

## 📄 许可证

本项目采用 MIT 许可证。

---

*为 ComfyUI 社区精心打造 ❤️*

> **"在 ComfyUI 中实现完整的 Photoshop 功能 - 专业节点，24 种混合模式"**